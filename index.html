<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECrew Absensi Transwisata</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dw901SwHHqfeWM&libraries=geometry&callback=initMaps"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-shadow {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .running-text {
            animation: scroll 20s linear infinite;
            white-space: nowrap;
        }
        
        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .hover-scale {
            transition: transform 0.2s ease;
        }
        
        .hover-scale:hover {
            transform: scale(1.02);
        }

        .map-container {
            height: 200px;
            width: 100%;
            border-radius: 8px;
        }

        .camera-preview {
            width: 100%;
            height: 200px;
            background: #f3f4f6;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .photo-preview {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen gradient-bg flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl card-shadow p-8 w-full max-w-md fade-in">
            <div class="text-center mb-8">
                <div class="bg-indigo-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-users text-indigo-600 text-3xl"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-800 mb-2">ECrew Absensi</h1>
                <p class="text-gray-600">Transwisata</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <div class="relative">
                        <i class="fas fa-envelope absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input type="email" id="username" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Masukkan email" required>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <div class="relative">
                        <i class="fas fa-lock absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input type="password" id="password" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Masukkan password" required>
                    </div>
                </div>
                
                <button type="submit" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-medium hover:bg-indigo-700 transition duration-200 hover-scale">
                    Masuk
                </button>
            </form>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboardPage" class="hidden min-h-screen bg-gray-50">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center">
                        <div class="bg-indigo-100 w-10 h-10 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-users text-indigo-600 text-lg"></i>
                        </div>
                        <h1 class="text-xl font-semibold text-gray-800">ECrew Absensi</h1>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-3">
                            <div class="bg-indigo-100 w-10 h-10 rounded-full flex items-center justify-center">
                                <i class="fas fa-user text-indigo-600"></i>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-800" id="userName">John Doe</p>
                                <p class="text-xs text-gray-500">Karyawan</p>
                            </div>
                        </div>
                        <button onclick="logout()" class="text-gray-500 hover:text-gray-700 transition duration-200">
                            <i class="fas fa-sign-out-alt text-lg"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Running Text -->
        <div class="bg-indigo-600 text-white py-2 overflow-hidden">
            <div class="running-text text-sm font-medium">
                ðŸŽ‰ Selamat datang di ECrew Application - Sistem Absensi Digital Transwisata ðŸŽ‰
            </div>
        </div>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Quick Actions -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-xl card-shadow p-6 hover-scale cursor-pointer" onclick="showTambahAbsen()">
                    <div class="flex items-center">
                        <div class="bg-green-100 w-12 h-12 rounded-lg flex items-center justify-center mr-4">
                            <i class="fas fa-plus text-green-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Tambah Absen</h3>
                            <p class="text-gray-600 text-sm">Catat kehadiran hari ini</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl card-shadow p-6 hover-scale cursor-pointer" onclick="showRiwayatAbsen()">
                    <div class="flex items-center">
                        <div class="bg-blue-100 w-12 h-12 rounded-lg flex items-center justify-center mr-4">
                            <i class="fas fa-history text-blue-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Riwayat Absen</h3>
                            <p class="text-gray-600 text-sm">Lihat data kehadiran</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl card-shadow p-6">
                    <div class="flex items-center">
                        <div class="bg-purple-100 w-12 h-12 rounded-lg flex items-center justify-center mr-4">
                            <i class="fas fa-chart-bar text-purple-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Statistik</h3>
                            <p class="text-gray-600 text-sm">85% kehadiran bulan ini</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Main Content -->
                <div class="lg:col-span-2">
                    <!-- Dashboard Overview -->
                    <div id="dashboardOverview" class="bg-white rounded-xl card-shadow p-6">
                        <h2 class="text-xl font-semibold text-gray-800 mb-6">Dashboard Overview</h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-gradient-to-r from-green-400 to-green-600 rounded-lg p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-green-100">Hari Ini</p>
                                        <p class="text-2xl font-bold">Hadir</p>
                                        <p class="text-sm text-green-100">08:15 WIB</p>
                                    </div>
                                    <i class="fas fa-check-circle text-3xl text-green-200"></i>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-blue-400 to-blue-600 rounded-lg p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-blue-100">Bulan Ini</p>
                                        <p class="text-2xl font-bold">22 Hari</p>
                                        <p class="text-sm text-blue-100">Total kehadiran</p>
                                    </div>
                                    <i class="fas fa-calendar-check text-3xl text-blue-200"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tambah Absen Form -->
                    <div id="tambahAbsenForm" class="hidden bg-white rounded-xl card-shadow p-6 fade-in">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-semibold text-gray-800">Form Absensi Lengkap</h2>
                            <button onclick="showDashboard()" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <form id="absenForm" class="space-y-6">
                            <!-- Personal Information -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h3 class="text-lg font-medium text-gray-800 mb-4">Informasi Personal</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                                        <input type="text" id="namaLengkap" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                        <input type="email" id="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Divisi</label>
                                        <input type="text" id="divisi" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required readonly>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Posisi</label>
                                        <input type="text" id="posisi" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Bertugas Sebagai</label>
                                        <select id="dutyas" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                                            <option value="">Pilih Tugas</option>
                                            <option value="Director">Director</option>
                                            <option value="Safety, Quality & Security Manager">Safety, Quality & Security Manager</option>
                                            <option value="Operation Manager">Operation Manager</option>
                                            <option value="Maintenance Manager">Maintenance Manager</option>
                                            <option value="Chief Pilot Fixed Wing">Chief Pilot Fixed Wing</option>
                                            <option value="Chief Pilot Rotary Wing">Chief Pilot Rotary Wing</option>
                                            <option value="Chief Flight Support">Chief Flight Support</option>
                                            <option value="Chief Inspector">Chief Inspector</option>
                                            <option value="Chief Engineer">Chief Engineer</option>
                                            <option value="Chief Finance, Accounting & Staf">Chief Finance, Accounting & Staf</option>
                                            <option value="Chief Engineering">Chief Engineering</option>
                                            <option value="Pilot in Command">Pilot in Command</option>
                                            <option value="Second in Command">Second in Command</option>
                                            <option value="Ground Instructor">Ground Instructor</option>
                                            <option value="Flight Instructor">Flight Instructor</option>
                                            <option value="Company Check Pilot">Company Check Pilot</option>
                                            <option value="Engineer">Engineer</option>
                                            <option value="Line Pilot">Line Pilot</option>
                                            <option value="Cabin Service">Cabin Service</option>
                                            <option value="Student">Student</option>
                                            <option value="Flight Support">Flight Support</option>
                                            <option value="Ground Support">Ground Support</option>
                                            <option value="Technical Representative">Technical Representative</option>
                                            <option value="Engineering">Engineering</option>
                                            <option value="Staff">Staff</option>
                                            <option value="Logistic">Logistic</option>
                                            <option value="Aviation Security">Aviation Security</option>
                                            <option value="Driver">Driver</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Jenis Pekerjaan</label>
                                        <select id="typeOfWork" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                                            <option value="">Pilih Jenis</option>
                                            <option value="Office Hour">Office Hour</option>
                                            <option value="Standby Flight">Standby Flight</option>
                                            <option value="Standby on Call">Standby on Call</option>
                                            <option value="Pos One Gate">Pos One Gate</option>
                                            <option value="Day Off">Day Off</option>
                                            <option value="Day Off 7 Consecutive Days for Pilot">Day Off 7 Consecutive Days for Pilot</option>
                                            <option value="Flight Duty VIP">Flight Duty VIP</option>
                                            <option value="Ferry Flight">Ferry Flight</option>
                                            <option value="PPC Simulator">PPC Simulator</option>
                                            <option value="PPC Aircraft">PPC Aircraft</option>
                                            <option value="Test Flight">Test Flight</option>
                                            <option value="Ground Run">Ground Run</option>
                                            <option value="Recurrent Training">Recurrent Training</option>
                                            <option value="Recency Flight">Recency Flight</option>
                                            <option value="Meeting Out of Office">Meeting Out of Office</option>
                                            <option value="Medical Examination">Medical Examination</option>
                                            <option value="Annual Leave">Annual Leave</option>
                                            <option value="Sick">Sick</option>
                                            <option value="Technical Representative">Technical Representative</option>
                                            <option value="Aviation Security">Aviation Security</option>
                                            <option value="Over Time">Over Time</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Status Absen -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Status Absen</label>
                                <select id="statusAbsen" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required onchange="toggleAbsenSections()">
                                    <option value="">Pilih Status</option>
                                    <option value="masuk">Absen Masuk</option>
                                    <option value="pulang">Absen Pulang</option>
                                </select>
                            </div>

                            <!-- Absen Masuk Section -->
                            <div id="absenMasukSection" class="hidden bg-blue-50 p-4 rounded-lg">
                                <h3 class="text-lg font-medium text-gray-800 mb-4">Absen Masuk</h3>
                                
                                <!-- Date -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal Masuk</label>
                                    <input type="date" id="tanggalMasuk" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                                </div>

                                <!-- Foto Masuk -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Foto Masuk</label>
                                    <div id="cameraPreviewMasuk" class="camera-preview mb-2">
                                        <i class="fas fa-camera text-4xl text-gray-400 mb-2"></i>
                                        <p class="text-gray-500 text-sm">Klik untuk mengambil foto</p>
                                    </div>
                                    <button type="button" onclick="openCamera('masuk')" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition duration-200">
                                        <i class="fas fa-camera mr-2"></i>Ambil Foto
                                    </button>
                                    <canvas id="canvasMasuk" style="display: none;"></canvas>
                                </div>

                                <!-- Location Masuk -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Lokasi Masuk</label>
                                    <div id="mapMasuk" class="map-container mb-2"></div>
                                    <button type="button" onclick="getCurrentLocation('masuk')" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition duration-200">
                                        <i class="fas fa-map-marker-alt mr-2"></i>Dapatkan Lokasi Saat Ini
                                    </button>
                                    <input type="hidden" id="latMasuk">
                                    <input type="hidden" id="lngMasuk">
                                </div>

                                <!-- Radius Status -->
                                <div id="radiusStatusMasuk" class="hidden mb-4">
                                    <div id="dalamRadiusMasuk" class="hidden bg-green-100 border border-green-300 text-green-800 px-4 py-3 rounded-lg">
                                        <i class="fas fa-check-circle mr-2"></i>Anda berada dalam radius kantor
                                    </div>
                                    <div id="luarRadiusMasuk" class="hidden">
                                        <div class="bg-red-100 border border-red-300 text-red-800 px-4 py-3 rounded-lg mb-2">
                                            <i class="fas fa-exclamation-triangle mr-2"></i>Anda berada di luar radius kantor
                                        </div>
                                        <textarea id="alasanLuarRadiusMasuk" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Jelaskan alasan berada di luar radius kantor" required></textarea>
                                    </div>
                                </div>

                                <!-- Waktu Masuk -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Waktu Masuk</label>
                                    <input type="text" id="waktuMasuk" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100 focus:ring-2 focus:ring-indigo-500 focus:border-transparent" readonly>
                                </div>

                                <!-- Status Masuk -->
                                <div id="statusMasukDiv" class="hidden mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Status Masuk</label>
                                    <div id="statusMasukText" class="px-4 py-3 rounded-lg font-medium"></div>
                                </div>

                                <!-- Alasan Terlambat -->
                                <div id="alasanTerlambatDiv" class="hidden mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Alasan Terlambat</label>
                                    <textarea id="alasanTerlambat" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Jelaskan alasan keterlambatan" required></textarea>
                                </div>

                                <button type="button" onclick="submitAbsenMasuk()" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-medium hover:bg-indigo-700 transition duration-200">
                                    Submit Absen Masuk
                                </button>
                            </div>

                            <!-- Absen Pulang Section -->
                            <div id="absenPulangSection" class="hidden bg-orange-50 p-4 rounded-lg">
                                <h3 class="text-lg font-medium text-gray-800 mb-4">Absen Pulang</h3>
                                
                                <!-- Remark Pekerjaan -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Remark Pekerjaan Hari Ini</label>
                                    <textarea id="remarkPekerjaan" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Deskripsikan pekerjaan yang telah diselesaikan hari ini" required></textarea>
                                </div>

                                <!-- Foto Pekerjaan -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Foto Pekerjaan Hari Ini</label>
                                    <div id="photoPreviewPekerjaan" class="camera-preview mb-2">
                                        <i class="fas fa-image text-4xl text-gray-400 mb-2"></i>
                                        <p class="text-gray-500 text-sm">Pilih foto dari galeri</p>
                                    </div>
                                    <input type="file" id="fotoPekerjaan" accept="image/*" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" onchange="previewImage(this, 'photoPreviewPekerjaan')" required>
                                </div>

                                <!-- Location Pulang -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Lokasi Pulang</label>
                                    <div id="mapPulang" class="map-container mb-2"></div>
                                    <button type="button" onclick="getCurrentLocation('pulang')" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition duration-200">
                                        <i class="fas fa-map-marker-alt mr-2"></i>Dapatkan Lokasi Saat Ini
                                    </button>
                                    <input type="hidden" id="latPulang">
                                    <input type="hidden" id="lngPulang">
                                </div>

                                <!-- Radius Status Pulang -->
                                <div id="radiusStatusPulang" class="hidden mb-4">
                                    <div id="dalamRadiusPulang" class="hidden bg-green-100 border border-green-300 text-green-800 px-4 py-3 rounded-lg">
                                        <i class="fas fa-check-circle mr-2"></i>Anda berada dalam radius kantor
                                    </div>
                                    <div id="luarRadiusPulang" class="hidden">
                                        <div class="bg-red-100 border border-red-300 text-red-800 px-4 py-3 rounded-lg mb-2">
                                            <i class="fas fa-exclamation-triangle mr-2"></i>Anda berada di luar radius kantor
                                        </div>
                                        <textarea id="alasanLuarRadiusPulang" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Jelaskan alasan berada di luar radius kantor" required></textarea>
                                    </div>
                                </div>

                                <!-- Waktu Pulang -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Waktu Pulang</label>
                                    <input type="text" id="waktuPulang" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100 focus:ring-2 focus:ring-indigo-500 focus:border-transparent" readonly>
                                </div>

                                <!-- Status Pulang -->
                                <div id="statusPulangDiv" class="hidden mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Status Pulang</label>
                                    <div id="statusPulangText" class="px-4 py-3 rounded-lg font-medium"></div>
                                </div>

                                <!-- Total Overtime -->
                                <div id="totalOvertimeDiv" class="hidden mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Total Overtime</label>
                                    <div id="totalOvertimeText" class="px-4 py-3 bg-yellow-100 border border-yellow-300 text-yellow-800 rounded-lg font-medium"></div>
                                </div>

                                <!-- Total Worktime -->
                                <div id="totalWorktimeDiv" class="hidden mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Total Waktu Kerja</label>
                                    <div id="totalWorktimeText" class="px-4 py-3 bg-blue-100 border border-blue-300 text-blue-800 rounded-lg font-medium"></div>
                                </div>

                                <button type="button" onclick="submitAbsenPulang()" class="w-full bg-orange-600 text-white py-3 rounded-lg font-medium hover:bg-orange-700 transition duration-200">
                                    Submit Absen Pulang
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Riwayat Absen -->
                    <div id="riwayatAbsenTable" class="hidden bg-white rounded-xl card-shadow p-6 fade-in">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-semibold text-gray-800">Riwayat Absen</h2>
                            <button onclick="showDashboard()" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Tanggal</th>
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Masuk</th>
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Pulang</th>
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Total Kerja</th>
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="riwayatAbsenBody">
                                    <tr class="border-b border-gray-100">
                                        <td class="py-3 px-4 text-gray-800">2024-01-15</td>
                                        <td class="py-3 px-4 text-gray-600">08:15</td>
                                        <td class="py-3 px-4 text-gray-600">17:30</td>
                                        <td class="py-3 px-4 text-gray-600">9j 15m</td>
                                        <td class="py-3 px-4">
                                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium">Tepat Waktu</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="lg:col-span-1">
                    <!-- Update News -->
                    <div class="bg-white rounded-xl card-shadow p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Update News</h3>
                        
                        <div class="space-y-4">
                            <div class="border-l-4 border-indigo-500 pl-4">
                                <h4 class="font-medium text-gray-800 text-sm">Sistem Absensi Baru</h4>
                                <p class="text-gray-600 text-xs mt-1">Fitur absensi digital telah aktif untuk semua karyawan</p>
                                <p class="text-gray-400 text-xs mt-2">2 hari yang lalu</p>
                            </div>
                            
                            <div class="border-l-4 border-green-500 pl-4">
                                <h4 class="font-medium text-gray-800 text-sm">Libur Nasional</h4>
                                <p class="text-gray-600 text-xs mt-1">Hari Kemerdekaan RI - 17 Agustus 2024</p>
                                <p class="text-gray-400 text-xs mt-2">1 minggu yang lalu</p>
                            </div>
                            
                            <div class="border-l-4 border-yellow-500 pl-4">
                                <h4 class="font-medium text-gray-800 text-sm">Maintenance Server</h4>
                                <p class="text-gray-600 text-xs mt-1">Sistem akan maintenance setiap Minggu pukul 02:00-04:00</p>
                                <p class="text-gray-400 text-xs mt-2">2 minggu yang lalu</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Info -->
                    <div class="bg-white rounded-xl card-shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Info Cepat</h3>
                        
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-gray-600 text-sm">Senin - Jumat</span>
                                <span class="text-gray-800 text-sm font-medium">09:00 - 17:00</span>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <span class="text-gray-600 text-sm">Sabtu</span>
                                <span class="text-gray-800 text-sm font-medium">09:00 - 14:30</span>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <span class="text-gray-600 text-sm">Toleransi</span>
                                <span class="text-gray-800 text-sm font-medium">1 menit</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Camera Modal -->
    <div id="cameraModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold">Ambil Foto</h3>
                <button onclick="closeCameraModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <video id="cameraVideo" class="w-full h-64 bg-gray-200 rounded-lg mb-4" autoplay></video>
            <div class="flex space-x-3">
                <button onclick="capturePhoto()" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                    <i class="fas fa-camera mr-2"></i>Ambil Foto
                </button>
                <button onclick="closeCameraModal()" class="flex-1 bg-gray-600 text-white py-2 rounded-lg hover:bg-gray-700">
                    Batal
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentCameraType = '';
        let cameraStream = null;
        let mapMasuk, mapPulang;
        let absenMasukData = null;

        // Office coordinates
        const officeCoords = [
            { lat: -6.267716, lng: 106.897317 },
            { lat: -6.265146, lng: 106.885701 }
        ];

        // Employee database
        const employeeData = {
            "Rustam Suhanda": { email: "managementtranswisata@gmail.com", division: "Staf", position: "President Director", role: "USER" },
            "Selfy Warauw": { email: "warauw_1@yahoo.com", division: "Staf", position: "Director", role: "USER" },
            "Muhamad Ramdani Masri": { email: "crunkbolcow@gmail.com", division: "Operation", position: "Chief Pilot Rotary Wing", role: "USER" },
            "Sulaksono Teddy Prabowo": { email: "fly5103@gmail.com", division: "Operation", position: "Line Pilot", role: "USER" },
            "Marcelino Bhaharoenawanto": { email: "marcelino412ep@gmail.com", division: "Operation", position: "Line Pilot", role: "USER" },
            "Muhamad Sofwan": { email: "sofwanm819@gmail.com", division: "Operation", position: "Chief Pilot Fixed Wing", role: "USER" },
            "Sofian M. L. Tobing": { email: "sofiantobing692@gmail.com", division: "Operation", position: "General Manager", role: "USER" },
            "Rico Febdiandana": { email: "ricofebdi@gmail.com", division: "Operation", position: "Chief Flight Support", role: "USER" },
            "Alfajri": { email: "alfajri_koto@yahoo.com", division: "Operation", position: "Line Pilot", role: "USER" },
            "Eli Setya": { email: "tioxpilot@gmail.com", division: "Operation", position: "Line Pilot", role: "USER" },
            "Susetyo Harijanto": { email: "harijantosusetyo@gmail.com", division: "Operation", position: "Operation Manager", role: "USER" },
            "Purwoko": { email: "purwoko.mulyono@yahoo.com", division: "Operation", position: "Line Pilot", role: "USER" },
            "Riza Hanindita": { email: "icul2122@gmail.com", division: "Operation", position: "Line Pilot", role: "USER" },
            "Henaldy Arifia Sudrajat": { email: "henaldy.ts204@gmail.com", division: "Operation", position: "Line Pilot", role: "USER" },
            "Kadek Amelia Nadya Berliana": { email: "amelberliana@yahoo.co.id", division: "Operation", position: "Line Pilot", role: "USER" },
            "Qorry Maulidya Natawijaya": { email: "qnatawijaya@gmail.com", division: "Operation", position: "Cabin Service", role: "USER" },
            "Shentira Anggia Putri": { email: "anggiashentira@gmail.com", division: "Operation", position: "Cabin Service", role: "USER" },
            "Tiffani Pricilia Hasan": { email: "tiffanipriciliaaaa@gmail.com", division: "Operation", position: "Cabin Service", role: "USER" },
            "Agustin Zulfani Prihatini": { email: "agustinzulfani74@gmail.com", division: "Operation", position: "Cabin Service", role: "USER" },
            "Nadya Casey Ivanka": { email: "ivankacasey99@gmail.com", division: "Operation", position: "Cabin Service", role: "USER" },
            "Yanu Prihatno": { email: "prihatnoyanu@gmail.com", division: "Maintenance", position: "Engineer", role: "USER" },
            "Bayu Nugroho": { email: "bayu.avicena@gmail.com", division: "Maintenance", position: "Engineer", role: "USER" },
            "Wahyudi Suseno": { email: "nawawahyudisuseno090@gmail.com", division: "Maintenance", position: "Avionic", role: "USER" },
            "Sigit Hardadi": { email: "sigithardadi88@yahoo.com", division: "Maintenance", position: "Engineer", role: "USER" },
            "Hadi Sutrisno": { email: "hadikamilatun@gmail.com", division: "Maintenance", position: "Maintenance Manager", role: "USER" },
            "Suhairi": { email: "suhairitwa@gmail.com", division: "Maintenance", position: "Engineer", role: "USER" },
            "Suyanto": { email: "yanto.umardin@gmail.com", division: "Maintenance", position: "Avionic", role: "USER" },
            "Lazarus Rio Raymond": { email: "rioraymond89@gmail.com", division: "Maintenance", position: "Engineer", role: "USER" },
            "Febie Aguti Effendi": { email: "mpiipie@gmail.com", division: "Maintenance", position: "Engineer", role: "USER" },
            "Diki Hariyanto": { email: "dikiatnu7@gmail.com", division: "Maintenance", position: "Chief Engineer", role: "USER" },
            "Prayit Susonggo": { email: "prayitsusonggo@yahoo.com", division: "Maintenance", position: "Avionic", role: "USER" },
            "Iskandar Akbar Hakim": { email: "iskandarakbarhakim@gmail.com", division: "Maintenance", position: "Chief Inspector", role: "USER" },
            "Arif Vrybadi Halim": { email: "GlexXRSvpcgo@outlook.com", division: "Maintenance", position: "Engineer", role: "USER" },
            "Alfiza Eka Putra": { email: "alfizaekap@gmail.com", division: "Maintenance", position: "Engineer", role: "USER" },
            "Dedi Prasetyo": { email: "deditren99@gmail.com", division: "Safety", position: "Aviation Security", role: "USER" },
            "Media H Marbun": { email: "mediamarbun@gmail.com", division: "Staf", position: "Human Resource Development", role: "USER" },
            "Fatmawati": { email: "ulieumeda@gmail.com", division: "Staf", position: "Finance", role: "USER" },
            "Dede Rahman Arafiq": { email: "d2rahman@yahoo.co.id", division: "Staf", position: "Finance", role: "USER" },
            "Leo Fitzgerald Sinay": { email: "leosinay@gmail.com", division: "Maintenance", position: "Chief Engineering", role: "USER" },
            "Khairul Zaman Pohan": { email: "pohan16zaman@gmail.com", division: "Operation", position: "Flight Support", role: "USER" },
            "Sentot Basuki": { email: "sentotbasuki@gmail.com", division: "Operation", position: "Flight Support", role: "USER" },
            "Bobby Feisal Mahardhika": { email: "bobby.feisal22@gmail.com", division: "Staf", position: "Engineering", role: "USER" },
            "Tri Widayat": { email: "tri3wiwid@gmail.com", division: "Operation", position: "Flight Support", role: "USER" },
            "Isdarminto": { email: "is.darminto35@gmail.com", division: "Staf", position: "Logistic", role: "USER" },
            "Sulaichan Noor Ali": { email: "sulaichann@gmail.com", division: "Staf", position: "Logistic", role: "USER" },
            "Sri Muljono Bayu Putro": { email: "sbayuputro@gmail.com", division: "Operation", position: "Flight Support", role: "USER" },
            "Asri Gatot Yulianto": { email: "Asrigatot.67@gmail.com", division: "Safety", position: "Aviation Security", role: "USER" },
            "Nanang Chabibi": { email: "nanangchabibi3@gmail.com", division: "Safety", position: "Aviation Security", role: "USER" },
            "Hariyanto": { email: "katellisna423@gmail.com", division: "Safety", position: "Aviation Security", role: "USER" },
            "Supriyono": { email: "fardhan0509@gmail.com", division: "Staf", position: "Kurir", role: "USER" },
            "Kasna": { email: "kasna.pjln799@gmail.com", division: "Staf", position: "Driver", role: "USER" },
            "Rizal Setiawan": { email: "rizalsetiawan020812@gmail.com", division: "Staf", position: "Driver", role: "USER" },
            "Ardi Rizki": { email: "ardi.rizk91@gmail.com", division: "Maintenance", position: "Engineer", role: "USER" },
            "Wawan Setiawan": { email: "setiawanwawan7312@gmail.com", division: "Operation", position: "Line Pilot", role: "USER" },
            "Tommy Saputra": { email: "tommysaputra473@gmail.com", division: "Staf", position: "Chief Finance, Accounting & Tax", role: "USER" },
            "Mochamad Riza": { email: "mch_riza@yahoo.com", division: "Safety", position: "Quality, Safety, Security Manager", role: "USER" },
            "Alexander Anggarda Yunan Devata": { email: "alexanderdevata@yahoo.co.id", division: "Operation", position: "Flight Support", role: "USER" },
            "Sukyono": { email: "sskkyy020@gmail.com", division: "Operation", position: "Flight Support", role: "USER" },
            "Admin-TWA": { email: "admin@twa.com", division: "HRD", position: "Admin", role: "ADMIN" }
        };

        // Create email to employee mapping for login
        const emailToEmployee = {};
        Object.keys(employeeData).forEach(name => {
            emailToEmployee[employeeData[name].email] = {
                name: name,
                ...employeeData[name]
            };
        });

        // Set current date and time
        function setCurrentDateTime() {
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            
            document.getElementById('tanggalMasuk').value = today;
            updateCurrentTime();
        }

        // Update current time with seconds
        function updateCurrentTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            const currentTime = `${hours}:${minutes}:${seconds}`;
            
            // Update both time fields with current time
            const waktuMasukField = document.getElementById('waktuMasuk');
            const waktuPulangField = document.getElementById('waktuPulang');
            
            if (waktuMasukField) {
                waktuMasukField.value = currentTime;
                // Auto-check status when time updates
                if (!waktuMasukField.classList.contains('hidden')) {
                    checkStatusMasuk();
                }
            }
            if (waktuPulangField) {
                waktuPulangField.value = currentTime;
                // Auto-check status when time updates
                if (!waktuPulangField.classList.contains('hidden') && absenMasukData) {
                    checkStatusPulang();
                }
            }
        }

        // Start real-time clock
        function startClock() {
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000); // Update every second
        }

        // Auto-fill user data
        function fillUserData() {
            if (window.currentUser) {
                document.getElementById('namaLengkap').value = window.currentUser.name;
                document.getElementById('email').value = window.currentUser.email;
                document.getElementById('divisi').value = window.currentUser.division;
                document.getElementById('posisi').value = window.currentUser.position;
                
                // Make these fields readonly since they're auto-filled
                document.getElementById('namaLengkap').readOnly = true;
                document.getElementById('email').readOnly = true;
                document.getElementById('divisi').readOnly = true;
                document.getElementById('posisi').readOnly = true;
                
                // Add styling to show they're auto-filled
                document.getElementById('namaLengkap').classList.add('bg-gray-100');
                document.getElementById('email').classList.add('bg-gray-100');
                document.getElementById('divisi').classList.add('bg-gray-100');
                document.getElementById('posisi').classList.add('bg-gray-100');
            }
        }

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Check if email exists in database
            const employee = emailToEmployee[email];
            if (!employee) {
                alert('Email tidak ditemukan dalam database karyawan!');
                return;
            }
            
            // Get first name for password validation
            const firstName = employee.name.split(' ')[0].toLowerCase();
            if (password.toLowerCase() !== firstName) {
                alert('Password salah! Gunakan nama depan Anda.');
                return;
            }
            
            // Store current user data
            window.currentUser = employee;
            
            document.getElementById('userName').textContent = employee.name;
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('dashboardPage').classList.remove('hidden');
            setCurrentDateTime();
            startClock(); // Start the real-time clock
            
            // Auto-fill form with user data
            fillUserData();
        });

        // Navigation functions
        function showTambahAbsen() {
            document.getElementById('dashboardOverview').classList.add('hidden');
            document.getElementById('riwayatAbsenTable').classList.add('hidden');
            document.getElementById('tambahAbsenForm').classList.remove('hidden');
            setCurrentDateTime();
            
            // Initialize maps with delay to ensure DOM is ready
            setTimeout(() => {
                initializeMaps();
            }, 500);
            
            fillUserData(); // Auto-fill when opening form
            
            // Auto-check status when time updates
            setTimeout(() => {
                checkStatusMasuk();
                if (absenMasukData) {
                    checkStatusPulang();
                }
            }, 1000);
        }

        function showRiwayatAbsen() {
            document.getElementById('dashboardOverview').classList.add('hidden');
            document.getElementById('tambahAbsenForm').classList.add('hidden');
            document.getElementById('riwayatAbsenTable').classList.remove('hidden');
        }

        function showDashboard() {
            document.getElementById('tambahAbsenForm').classList.add('hidden');
            document.getElementById('riwayatAbsenTable').classList.add('hidden');
            document.getElementById('dashboardOverview').classList.remove('hidden');
        }

        function logout() {
            document.getElementById('dashboardPage').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('loginForm').reset();
        }

        // Toggle absen sections
        function toggleAbsenSections() {
            const status = document.getElementById('statusAbsen').value;
            const masukSection = document.getElementById('absenMasukSection');
            const pulangSection = document.getElementById('absenPulangSection');
            
            if (status === 'masuk') {
                masukSection.classList.remove('hidden');
                pulangSection.classList.add('hidden');
            } else if (status === 'pulang') {
                if (!absenMasukData) {
                    alert('Anda harus melakukan absen masuk terlebih dahulu!');
                    document.getElementById('statusAbsen').value = '';
                    return;
                }
                masukSection.classList.add('hidden');
                pulangSection.classList.remove('hidden');
            } else {
                masukSection.classList.add('hidden');
                pulangSection.classList.add('hidden');
            }
        }

        // Global callback for Google Maps API
        function initMaps() {
            // This function is called when Google Maps API is loaded
            console.log('Google Maps API loaded');
        }

        // Initialize maps
        function initializeMaps() {
            if (typeof google === 'undefined' || !google.maps) {
                console.error('Google Maps API not loaded');
                return;
            }
            
            // Map for check-in
            mapMasuk = new google.maps.Map(document.getElementById('mapMasuk'), {
                zoom: 15,
                center: { lat: -6.2088, lng: 106.8456 }
            });

            // Map for check-out
            mapPulang = new google.maps.Map(document.getElementById('mapPulang'), {
                zoom: 15,
                center: { lat: -6.2088, lng: 106.8456 }
            });
        }

        // Get current location
        function getCurrentLocation(type) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        
                        if (type === 'masuk') {
                            document.getElementById('latMasuk').value = lat;
                            document.getElementById('lngMasuk').value = lng;
                            
                            mapMasuk.setCenter({ lat, lng });
                            new google.maps.Marker({
                                position: { lat, lng },
                                map: mapMasuk,
                                title: 'Lokasi Anda'
                            });
                            
                            checkRadius(lat, lng, 'masuk');
                        } else {
                            document.getElementById('latPulang').value = lat;
                            document.getElementById('lngPulang').value = lng;
                            
                            mapPulang.setCenter({ lat, lng });
                            new google.maps.Marker({
                                position: { lat, lng },
                                map: mapPulang,
                                title: 'Lokasi Anda'
                            });
                            
                            checkRadius(lat, lng, 'pulang');
                        }
                    },
                    function(error) {
                        alert('Error getting location: ' + error.message);
                    }
                );
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        }

        // Check if location is within radius
        function checkRadius(lat, lng, type) {
            const userLocation = new google.maps.LatLng(lat, lng);
            let withinRadius = false;
            
            for (let coord of officeCoords) {
                const officeLocation = new google.maps.LatLng(coord.lat, coord.lng);
                const distance = google.maps.geometry.spherical.computeDistanceBetween(userLocation, officeLocation);
                
                if (distance <= 250) {
                    withinRadius = true;
                    break;
                }
            }
            
            const radiusStatus = document.getElementById(`radiusStatus${type.charAt(0).toUpperCase() + type.slice(1)}`);
            const dalamRadius = document.getElementById(`dalamRadius${type.charAt(0).toUpperCase() + type.slice(1)}`);
            const luarRadius = document.getElementById(`luarRadius${type.charAt(0).toUpperCase() + type.slice(1)}`);
            
            radiusStatus.classList.remove('hidden');
            
            if (withinRadius) {
                dalamRadius.classList.remove('hidden');
                luarRadius.classList.add('hidden');
            } else {
                dalamRadius.classList.add('hidden');
                luarRadius.classList.remove('hidden');
            }
        }

        // Camera functions
        function openCamera(type) {
            currentCameraType = type;
            document.getElementById('cameraModal').classList.remove('hidden');
            
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function(stream) {
                    cameraStream = stream;
                    document.getElementById('cameraVideo').srcObject = stream;
                })
                .catch(function(error) {
                    alert('Error accessing camera: ' + error.message);
                    closeCameraModal();
                });
        }

        function capturePhoto() {
            const video = document.getElementById('cameraVideo');
            const canvas = document.getElementById('canvasMasuk');
            const context = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0);
            
            const imageData = canvas.toDataURL('image/jpeg');
            
            // Display captured photo
            const preview = document.getElementById('cameraPreviewMasuk');
            preview.innerHTML = `<img src="${imageData}" class="photo-preview" alt="Foto Masuk">`;
            
            closeCameraModal();
        }

        function closeCameraModal() {
            document.getElementById('cameraModal').classList.add('hidden');
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
        }

        // Preview image from file input
        function previewImage(input, previewId) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById(previewId).innerHTML = 
                        `<img src="${e.target.result}" class="photo-preview" alt="Preview">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Check status masuk
        function checkStatusMasuk() {
            const waktu = document.getElementById('waktuMasuk').value;
            if (!waktu) return;
            
            const statusDiv = document.getElementById('statusMasukDiv');
            const statusText = document.getElementById('statusMasukText');
            const alasanDiv = document.getElementById('alasanTerlambatDiv');
            
            statusDiv.classList.remove('hidden');
            
            // Parse time with seconds (HH:MM:SS format)
            const timeParts = waktu.split(':');
            const hours = parseInt(timeParts[0]);
            const minutes = parseInt(timeParts[1]);
            const waktuMasuk = hours * 60 + minutes;
            const batasWaktu = 9 * 60; // 09:00
            
            if (waktuMasuk <= batasWaktu) {
                statusText.textContent = 'Terima Kasih Anda Telah Absen Tepat Waktu';
                statusText.className = 'px-4 py-3 bg-green-100 border border-green-300 text-green-800 rounded-lg font-medium';
                alasanDiv.classList.add('hidden');
            } else {
                statusText.textContent = 'Anda Terlambat Absen';
                statusText.className = 'px-4 py-3 bg-red-100 border border-red-300 text-red-800 rounded-lg font-medium';
                alasanDiv.classList.remove('hidden');
            }
        }

        // Check status pulang
        function checkStatusPulang() {
            const waktu = document.getElementById('waktuPulang').value;
            if (!waktu || !absenMasukData) return;
            
            const statusDiv = document.getElementById('statusPulangDiv');
            const statusText = document.getElementById('statusPulangText');
            const overtimeDiv = document.getElementById('totalOvertimeDiv');
            const overtimeText = document.getElementById('totalOvertimeText');
            const worktimeDiv = document.getElementById('totalWorktimeDiv');
            const worktimeText = document.getElementById('totalWorktimeText');
            
            statusDiv.classList.remove('hidden');
            worktimeDiv.classList.remove('hidden');
            
            // Parse time with seconds (HH:MM:SS format)
            const timeParts = waktu.split(':');
            const hours = parseInt(timeParts[0]);
            const minutes = parseInt(timeParts[1]);
            const waktuPulang = hours * 60 + minutes;
            const batas1 = 17 * 60; // 17:00
            const batas2 = 17 * 60 + 30; // 17:30
            const batas3 = 17 * 60 + 31; // 17:31
            
            // Calculate total worktime
            const masukTimeParts = absenMasukData.waktu.split(':');
            const waktuMasukMinutes = parseInt(masukTimeParts[0]) * 60 + parseInt(masukTimeParts[1]);
            const totalMinutes = waktuPulang - waktuMasukMinutes;
            const totalHours = Math.floor(totalMinutes / 60);
            const remainingMinutes = totalMinutes % 60;
            
            worktimeText.textContent = `${totalHours} jam ${remainingMinutes} menit`;
            
            if (waktuPulang < batas1) {
                statusText.textContent = 'Anda Pulang Sebelum Waktunya';
                statusText.className = 'px-4 py-3 bg-yellow-100 border border-yellow-300 text-yellow-800 rounded-lg font-medium';
                overtimeDiv.classList.add('hidden');
            } else if (waktuPulang >= batas1 && waktuPulang <= batas2) {
                statusText.textContent = 'Anda Pulang Tepat Waktu';
                statusText.className = 'px-4 py-3 bg-green-100 border border-green-300 text-green-800 rounded-lg font-medium';
                overtimeDiv.classList.add('hidden');
            } else if (waktuPulang >= batas3) {
                statusText.textContent = 'Waktu Kerja Melebihi';
                statusText.className = 'px-4 py-3 bg-blue-100 border border-blue-300 text-blue-800 rounded-lg font-medium';
                
                // Calculate overtime
                const overtimeMinutes = waktuPulang - batas2;
                const overtimeHours = Math.floor(overtimeMinutes / 60);
                const remainingOvertimeMinutes = overtimeMinutes % 60;
                
                overtimeText.textContent = `${overtimeHours} jam ${remainingOvertimeMinutes} menit`;
                overtimeDiv.classList.remove('hidden');
            }
        }

        // Submit absen masuk
        function submitAbsenMasuk() {
            const form = document.getElementById('absenForm');
            const formData = new FormData(form);
            
            // Validate required fields for absen masuk
            const requiredFields = ['namaLengkap', 'email', 'divisi', 'posisi', 'dutyas', 'typeOfWork', 'tanggalMasuk', 'waktuMasuk'];
            let isValid = true;
            
            for (let field of requiredFields) {
                if (!document.getElementById(field).value) {
                    isValid = false;
                    break;
                }
            }
            
            // Check if photo is taken
            const photoPreview = document.getElementById('cameraPreviewMasuk');
            if (!photoPreview.querySelector('img')) {
                alert('Silakan ambil foto terlebih dahulu!');
                return;
            }
            
            // Check if location is set
            if (!document.getElementById('latMasuk').value) {
                alert('Silakan dapatkan lokasi terlebih dahulu!');
                return;
            }
            
            if (!isValid) {
                alert('Silakan lengkapi semua field yang diperlukan!');
                return;
            }
            
            // Store absen masuk data
            absenMasukData = {
                nama: document.getElementById('namaLengkap').value,
                email: document.getElementById('email').value,
                divisi: document.getElementById('divisi').value,
                posisi: document.getElementById('posisi').value,
                dutyas: document.getElementById('dutyas').value,
                typeOfWork: document.getElementById('typeOfWork').value,
                tanggal: document.getElementById('tanggalMasuk').value,
                waktu: document.getElementById('waktuMasuk').value,
                lat: document.getElementById('latMasuk').value,
                lng: document.getElementById('lngMasuk').value
            };
            
            alert('Absen masuk berhasil disimpan!');
            
            // Reset form and show dashboard
            document.getElementById('statusAbsen').value = '';
            document.getElementById('absenMasukSection').classList.add('hidden');
        }

        // Submit absen pulang
        function submitAbsenPulang() {
            // Validate required fields for absen pulang
            const requiredFields = ['remarkPekerjaan', 'waktuPulang'];
            let isValid = true;
            
            for (let field of requiredFields) {
                if (!document.getElementById(field).value) {
                    isValid = false;
                    break;
                }
            }
            
            // Check if photo is uploaded
            if (!document.getElementById('fotoPekerjaan').files[0]) {
                alert('Silakan pilih foto pekerjaan!');
                return;
            }
            
            // Check if location is set
            if (!document.getElementById('latPulang').value) {
                alert('Silakan dapatkan lokasi terlebih dahulu!');
                return;
            }
            
            if (!isValid) {
                alert('Silakan lengkapi semua field yang diperlukan!');
                return;
            }
            
            // Add to riwayat table
            const tbody = document.getElementById('riwayatAbsenBody');
            const newRow = document.createElement('tr');
            newRow.className = 'border-b border-gray-100';
            
            const waktuMasuk = absenMasukData.waktu;
            const waktuPulang = document.getElementById('waktuPulang').value;
            const totalWorktime = document.getElementById('totalWorktimeText').textContent;
            
            newRow.innerHTML = `
                <td class="py-3 px-4 text-gray-800">${absenMasukData.tanggal}</td>
                <td class="py-3 px-4 text-gray-600">${waktuMasuk}</td>
                <td class="py-3 px-4 text-gray-600">${waktuPulang}</td>
                <td class="py-3 px-4 text-gray-600">${totalWorktime}</td>
                <td class="py-3 px-4">
                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium">Lengkap</span>
                </td>
            `;
            
            tbody.insertBefore(newRow, tbody.firstChild);
            
            alert('Absen pulang berhasil disimpan!');
            
            // Reset form and show dashboard
            document.getElementById('absenForm').reset();
            document.getElementById('statusAbsen').value = '';
            document.getElementById('absenPulangSection').classList.add('hidden');
            absenMasukData = null;
            showDashboard();
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9759d27b6286fcfe',t:'MTc1NjI3OTM5Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
